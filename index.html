<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate DAO Treasury</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-icon">üåç</div>
            <h1>Climate DAO Treasury</h1>
            <p class="subtitle">Fund environmental projects on Cardano blockchain</p>
        </header>

        <!-- Connect Wallet -->
        <div class="wallet-section">
            <button id="connectWallet" class="btn btn-primary btn-large">
                <span class="btn-icon">üîó</span>
                Connect Wallet
            </button>
            <div id="walletInfo" class="wallet-info hidden">
                <div class="info-label">Connected Wallet</div>
                <div id="walletAddress" class="wallet-address">-</div>
            </div>
        </div>

        <!-- Main App -->
        <div id="app" class="hidden">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="create">
                    <span class="tab-icon">‚ûï</span>
                    Create Proposal
                </button>
                <button class="tab-btn" data-tab="cancel">
                    <span class="tab-icon">‚ùå</span>
                    Cancel Proposal
                </button>
                <button class="tab-btn" data-tab="release">
                    <span class="tab-icon">üí∞</span>
                    Release Funds
                </button>
            </div>

            <!-- CREATE PROPOSAL -->
            <div id="create" class="tab-content active">
                <div class="panel">
                    <h2 class="panel-title">
                        <span class="panel-icon">üìù</span>
                        Create Funding Proposal
                    </h2>

                    <!-- Funding Goal -->
                    <div class="form-group">
                        <label class="form-label">
                            Funding Goal (ADA)
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="fundingGoal" 
                            class="input-field" 
                            placeholder="Enter amount in ADA"
                            value="10"
                            min="1"
                            step="0.01"
                        />
                        <small class="help-text">Minimum 1 ADA required for the project</small>
                    </div>

                    <!-- Voting Deadline -->
                    <div class="form-group">
                        <label class="form-label">
                            Voting Deadline
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="votingDeadline" 
                            class="input-field" 
                            placeholder="Click button to set deadline"
                            readonly
                        />
                        <div class="deadline-helper">
                            <div class="time-display">
                                <span class="time-icon">üïê</span>
                                <span id="currentTime">Loading...</span>
                            </div>
                            <div class="deadline-buttons">
                                <button id="setDeadline5Min" class="btn btn-small btn-outline">
                                    5 Minutes
                                </button>
                                <button id="setDeadline1Month" class="btn btn-small btn-outline">
                                    1 Month
                                </button>
                                <button id="setDeadline2Months" class="btn btn-small btn-outline">
                                    2 Months
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Recipient -->
                    <div class="form-group recipient-section">
                        <div class="section-header">
                            <div class="section-icon">üë§</div>
                            <div>
                                <h3 class="section-title">Beneficiary (Recipient)</h3>
                                <p class="section-subtitle">Who will receive the funds if approved</p>
                            </div>
                        </div>
                        
                        <label class="form-label">
                            Cardano Address
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="recipient" 
                            class="input-field" 
                            placeholder="addr_test1... or addr1..."
                        />
                        <small class="help-text">
                            Using your own address for testing. Change if needed.
                        </small>
                        <div id="addressValidation" class="validation-message"></div>
                    </div>

                    <!-- Warning Box -->
                    <div class="alert alert-warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <div class="alert-title">Important</div>
                            <ul class="alert-list">
                                <li>Verify recipient address - transactions are irreversible</li>
                                <li>Funds will be locked until voting deadline</li>
                                <li>Only proposer can cancel before deadline</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Create Button -->
                    <button id="createBtn" class="btn btn-success btn-large">
                        <span class="btn-icon">üöÄ</span>
                        Create Proposal
                    </button>
                </div>
            </div>

            <!-- CANCEL PROPOSAL -->
            <div id="cancel" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title">
                        <span class="panel-icon">üö´</span>
                        Cancel Proposal
                    </h2>

                    <div class="description-box">
                        <p>Cancel your proposal and get your funds back before the voting deadline expires.</p>
                    </div>

                    <!-- Status Info -->
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">Current Time</div>
                            <div id="cancelCurrentTime" class="status-value">-</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Proposal Deadline</div>
                            <div id="proposalDeadline" class="status-value" data-deadline="">Not created yet</div>
                        </div>
                        <div class="status-item highlight">
                            <div class="status-label">Time Remaining</div>
                            <div id="timeRemaining" class="status-value">-</div>
                        </div>
                    </div>

                    <button id="cancelBtn" class="btn btn-danger btn-large">
                        <span class="btn-icon">‚õî</span>
                        Cancel My Proposal
                    </button>

                    <div class="alert alert-info">
                        <div class="alert-icon">‚ÑπÔ∏è</div>
                        <div class="alert-content">
                            <div class="alert-title">Requirements</div>
                            <ul class="alert-list">
                                <li>You must be the proposer</li>
                                <li>Deadline must not have passed</li>
                                <li>Funds will be returned to your wallet</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RELEASE FUNDS -->
            <div id="release" class="tab-content">
                <div class="panel">
                    <h2 class="panel-title">
                        <span class="panel-icon">üí∏</span>
                        Release Funds
                    </h2>

                    <div class="description-box">
                        <p>Release the locked funds to the beneficiary after the voting deadline has passed.</p>
                    </div>

                    <div class="alert alert-success">
                        <div class="alert-icon">‚úÖ</div>
                        <div class="alert-content">
                            <div class="alert-title">This Action Will:</div>
                            <ul class="alert-list">
                                <li>Send funds to the designated beneficiary</li>
                                <li>Complete the funding proposal</li>
                                <li>Only works after voting deadline</li>
                            </ul>
                        </div>
                    </div>

                    <button id="releaseBtn" class="btn btn-success btn-large">
                        <span class="btn-icon">üí∞</span>
                        Release Funds to Beneficiary
                    </button>
                </div>
            </div>

            <!-- Transaction Log -->
            <div class="log-section">
                <h3 class="log-title">
                    <span class="log-icon">üìú</span>
                    Transaction Log
                </h3>
                <div id="log" class="log-output">Ready to create proposals...</div>
            </div>
        </div>
    </div>

    <script>
        // Time updates
        function updateTimeDisplays() {
            const now = new Date();
            const nowMs = Date.now();
            
            const currentTimeEl = document.getElementById('currentTime');
            if (currentTimeEl) {
                currentTimeEl.textContent = now.toLocaleTimeString();
            }
            
            const cancelTimeEl = document.getElementById('cancelCurrentTime');
            if (cancelTimeEl) {
                cancelTimeEl.textContent = now.toLocaleString();
            }

            // Time remaining
            const deadlineEl = document.getElementById('proposalDeadline');
            const remainingEl = document.getElementById('timeRemaining');
            if (deadlineEl && deadlineEl.dataset.deadline) {
                const deadline = parseInt(deadlineEl.dataset.deadline);
                const remaining = deadline - nowMs;
                if (remaining > 0) {
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    remainingEl.textContent = `${minutes}m ${seconds}s`;
                    remainingEl.style.color = '#10b981';
                } else {
                    remainingEl.textContent = 'EXPIRED';
                    remainingEl.style.color = '#ef4444';
                }
            }
        }

        setInterval(updateTimeDisplays, 1000);
        updateTimeDisplays();

        // Deadline setters
        document.getElementById('setDeadline5Min').addEventListener('click', () => {
            const time = Date.now() + (5 * 60 * 1000);
            document.getElementById('votingDeadline').value = time;
            log(`‚úì Deadline: ${new Date(time).toLocaleString()}`);
        });

        document.getElementById('setDeadline1Month').addEventListener('click', () => {
            const time = Date.now() + (30 * 24 * 60 * 1000);
            document.getElementById('votingDeadline').value = time;
            log(`‚úì Deadline: ${new Date(time).toLocaleString()}`);
        });

        document.getElementById('setDeadline2Months').addEventListener('click', () => {
            const time = Date.now() + (60 * 24 * 60 * 60 * 1000);
            document.getElementById('votingDeadline').value = time;
            log(`‚úì Deadline: ${new Date(time).toLocaleString()}`);
        });

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.dataset.tab;
                
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(target).classList.add('active');
            });
        });

        // Address validation
        document.getElementById('recipient')?.addEventListener('input', (e) => {
            const addr = e.target.value;
            const validationEl = document.getElementById('addressValidation');
            
            if (!addr) {
                validationEl.textContent = '';
                validationEl.className = 'validation-message';
            } else if (addr.startsWith('addr1') || addr.startsWith('addr_test1')) {
                validationEl.textContent = '‚úì Valid address format';
                validationEl.className = 'validation-message success';
            } else {
                validationEl.textContent = '‚úó Invalid Cardano address';
                validationEl.className = 'validation-message error';
            }
        });

        // Store deadline
        window.setProposalDeadline = function(deadline) {
            const el = document.getElementById('proposalDeadline');
            el.dataset.deadline = deadline;
            el.textContent = new Date(parseInt(deadline)).toLocaleString();
        };

        function log(msg) {
            // Defined in JS module
        }
    </script>

    <script type="module" src="dao.js"></script>
</body>
</html>
